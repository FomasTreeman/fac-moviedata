<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Data</title>
    <link rel="stylesheet" href="index.css">
</head>

<body>
    <div id="blur" style="display: none"></div>
    <div class="container">
        <header> Movie Data </header>
        <div class="dropdown">
            <button class="dropbtn">filter</button>
            <div class="dropdown-content">
                <a onclick="reorder(alphOrderAsc.reverse());" href="#">Alphabetical</a>
                <a onclick="reorder(yearOrderAsc.reverse());" href="#">Year</a>
                <a onclick="reorder(rateOrderAsc.reverse());" href="#">Rating</a>
                <a onclick="reorder(timeOrderAsc.reverse());" href="#">Runtime</a>
            </div>
        </div>
    </div>
    <div id="movies">
        <div class="inputForm" style="order:1000">
            <h1 style="margin-top: 0px"> Add a movie </h1>
            <form>
                <label for="title">Movie title:</label><br>
                <input type="text" id="ntitle" name="title"><br>
                <label for="plot">Plot:</label><br>
                <input type="text" id="nplot" name="plot"><br>
                <label for="year">Year:</label><br>
                <input type="text" id="nyear" name="year"><br>
                <label for="runtime">Runtime:</label><br>
                <input type="text" id="nruntime" name="runtime"><br>
                <label for="rating">Rating:</label><br>
                <input type="text" id="nrating" name="rating"><br>
                <label for="cast">Cast:</label><br>
                <input type="text" id="ncast" name="cast"><br>
                <button onClick="addMovie()" type="button" class="btn"> Submit </button>
            </form>
        </div>
    </div>
    <div class="form-popup" id="editForm">
        <h1 id="movieTitle" style="padding-bottom: 0.5rem"> </h1>
        <form class="form-container">
            <form>
                <label for="plot">Plot</label><br>
                <input type="text" id="uplot" name="plot"><br>
                <label for="year">Year</label><br>
                <input type="text" id="uyear" name="year"><br>
                <label for="runtime">Runtime</label><br>
                <input type="text" id="uruntime" name="runtime"><br>
                <label for="rating">Rating</label><br>
                <input type="text" id="urating" name="rating"><br>
                <label for="cast">Cast</label><br>
                <input type="text" id="ucast" name="cast"><br>
                <button type="button" class="form-btn" onclick="updateMovie()">Make changes</button>
                <button type="button" class="form-btn cancel" onclick="closeForm()">Close</button>
            </form>
        </form>
    </div>
    <script>
        // [The Dar..., The Roal...., Fantastic..., The Grand...]
        const alphOrderAsc = [0, 3, 1, 2];
        const yearOrderAsc = [1, 0, 2, 3];
        const rateOrderAsc = [0, 1, 2, 3];
        const timeOrderAsc = [1, 3, 0, 2];

        let movieData = {
            "The Darjeeling Limited": {
                plot: "A year after their father's funeral, three brothers travel across India by train in an attempt to bond with each other.",
                cast: [
                    "Jason Schwartzman",
                    "Owen Wilson",
                    "Adrien Brody"
                ],
                runtime: 151,
                rating: 7.2,
                year: 2007,
            },
            "The Royal Tenenbaums": {
                plot: "The eccentric members of a dysfunctional family reluctantly gather under the same roof for various reasons",
                rating: 7.6,
                year: 2001,
                cast: [
                    "Gene Hackman",
                    "Gwnyeth Paltrow",
                    "Anjelica Huston"
                ],
                runtime: 170,
            },
            "Fantastic Mr. Fox": {
                year: 2009,
                plot: "An urbane fox cannot resist returning to his farm raiding ways and then must help his community survive the farmers' retaliation.",
                cast: [
                    "George Clooney",
                    "Meryl Streep",
                    "Bill Murray",
                    "Jason Schwartzman",
                ],
                runtime: 147,
                rating: 7.9,
            },
            "The Grand Budapest Hotel": {
                rating: 8.1,
                runtime: 159,
                year: 2014,
                plot: "A writer encounters the owner of an aging high-class hotel, who tells him of his early years serving as a lobby boy in the hotel's glorious years under an exceptional concierge.",
                cast: [
                    "Ralph Fiennes",
                    "F. Murray Abraham",
                    "Mathieu Amalric"
                ],
            },
        };

        // cast selection

        // add movie
        function addMovie() {
            let form = document.getElementsByTagName("form");
            const data = new FormData(form[0]);
            movieTitle = data.get("title");
            newMovieInfo = {};
            data.forEach((value, key) => { if (key !== "title") newMovieInfo[key] = value });
            movieData[movieTitle] = newMovieInfo;

            createCard(movieTitle);
        }

        function updateMovie() {
            let form = document.getElementsByTagName("form");
            const data = new FormData(form[1]);
            title = document.getElementById("movieTitle").innerHTML;
            let oldData = movieData[title];
            data.forEach((value, key) => { if (value !== oldData[key]) oldData[key] = value });
            console.log(movieData[title]);
            updateCard(title);
            closeForm();
        }

        function updateCard(title) {
            let card = document.getElementById(title);
            movieInfo = movieData[title];
            const plot = document.getElementById(title + ".plot");
            plot.innerHTML = "plot: " + movieInfo.plot;
            const year = document.getElementById(title + ".year");
            year.innerHTML = "plot: " + movieInfo.year;
            const runtime = document.getElementById(title + ".runtime");
            runtime.innerHTML = "plot: " + movieInfo.runtime;
            const rating = document.getElementById(title + ".rating");
            rating.innerHTML = "plot: " + movieInfo.rating;
            const cast = document.getElementById(title + ".cast");
            cast.innerHTML = "plot: " + movieInfo.cast;
            // let index = 2;
            // for (const key in movieInfo) {
            //     console.log(index);
            //     console.log(card.childNodes[index]);
            //     card.childNodes[index].innerHTML = movieInfo[key];
            //     index++;
            // };

        }

        function createList() {
            for (const key in movieData) {
                createCard(key);
            }
        }

        function createCard(title) {
            let movieJson = movieData[title];
            let movieElement = document.createElement("div");
            movieElement.setAttribute("class", "card")
            movieElement.setAttribute("style", "order: 0")
            movieElement.setAttribute("id", title);
            let titleElement = document.createElement("p");
            let movieInfoElement = document.createElement("ul");
            movieElement.appendChild(titleElement);
            movieElement.appendChild(movieInfoElement);

            for (const [key, value] of Object.entries(movieJson)) {
                if (key !== "title") {
                    let element = document.createElement("li");
                    element.setAttribute("id", title + "." + key);
                    element.innerHTML = key + ": " + value;
                    movieElement.appendChild(element);
                }
            };

            let editElement = document.createElement("button");
            editElement.setAttribute("class", "btn")
            editElement.setAttribute("onclick", "openForm('" + title + "')");
            titleElement.innerHTML = title;
            editElement.innerHTML = "edit";
            movieElement.appendChild(editElement);
            let moviesElement = document.getElementById("movies");
            moviesElement.appendChild(movieElement);
        };


        // IMPROVEMENT  toggle rather than two functions
        function openForm(key) {
            document.getElementById("editForm").style.display = "block";
            document.getElementById("blur").style.display = 'block';
            populateForm(key)
        }

        function closeForm() {
            document.getElementById("editForm").style.display = "none";
            document.getElementById("blur").style.display = 'none';
        }

        function populateForm(key) {
            let movieJson = movieData[key];
            console.log(key)
            for (const [key, value] of Object.entries(movieJson)) {
                
            }

            document.getElementById("movieTitle").innerHTML = key;
            document.getElementById("uplot").setAttribute("value", movieJson["plot"]);
            document.getElementById("uyear").setAttribute("value", movieJson["year"]);
            document.getElementById("uruntime").setAttribute("value", movieJson["runtime"]);
            document.getElementById("urating").setAttribute("value", movieJson["rating"]);
            document.getElementById("ucast").setAttribute("value", movieJson["cast"]);
        }

        function reorder(order = null) {
            if (order == null) {
                createList()
            } else {
                const cards = document.getElementsByClassName("card");
                Array.from(cards).forEach((element, index) => {
                    element.setAttribute("style", "order: " + order[index])
                }); {
                }

                // 
                // potential but for aesthetics rather than clearing child nodes, just use css to move elements
                // 

                // const temp = document.createDocumentFragment();
                // const container = document.getElementById("movies");
                // for (let index in order) {temp.appendChild(cards[index])};
                // container.appendChild(temp);
            }
        };

        reorder();
    </script>
</body>

</html>