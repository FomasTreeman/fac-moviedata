<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Data</title>
    <link rel="stylesheet" href="index.css">
</head>

<body>
    <div id="blur" style="display: none"></div>
    <div class="container">
        <header> Movie Data </header>
        <div class="dropdown">
            <button class="dropbtn">filter</button>
            <div class="dropdown-content">
                <a onclick="reorder(alphOrderAsc.reverse());" href="#">Alphabetical</a>
                <a onclick="reorder(yearOrderAsc.reverse());" href="#">Year</a>
                <a onclick="reorder(rateOrderAsc.reverse());" href="#">Rating</a>
                <a onclick="reorder(timeOrderAsc.reverse());" href="#">Runtime</a>
            </div>
        </div>
    </div>
    <div id="movies">
        <div class="inputForm" style="order:1000">
            <h1 style="margin-top: 0px"> Add a movie </h1>
            <form>
                <label for="title">Movie title:</label><br>
                <input type="text" id="ntitle" name="title"><br>
                <label for="plot">Plot:</label><br>
                <input type="text" id="nplot" name="plot"><br>
                <label for="year">Year:</label><br>
                <input type="text" id="nyear" name="year"><br>
                <label for="runtime">Runtime:</label><br>
                <input type="text" id="nruntime" name="runtime"><br>
                <label for="rating">Rating:</label><br>
                <input type="text" id="nrating" name="rating"><br>
                <label for="cast">Cast:</label><br>
                <input type="text" id="ncast" name="cast"><br>
                <button onClick="addMovie()" type="button" class="btn"> Submit </button>
            </form>
        </div>
    </div>
    <div class="form-popup" id="editForm">
        <h1 id="movieTitle" style="padding-bottom: 0.5rem"> </h1>
        <form class="form-container">
            <form>
                <label for="plot">Plot</label><br>
                <input type="text" id="uplot" name="plot"><br>
                <label for="year">Year</label><br>
                <input type="text" id="uyear" name="year"><br>
                <label for="runtime">Runtime</label><br>
                <input type="text" id="uruntime" name="runtime"><br>
                <label for="rating">Rating</label><br>
                <input type="text" id="urating" name="rating"><br>
                <label for="cast">Cast</label><br>
                <input type="text" id="ucast" name="cast"><br>
                <button type="button" class="form-btn" onclick="updateMovie()">Make changes</button>
                <button type="button" class="form-btn cancel" onclick="closeForm()">Close</button>
            </form>
        </form>
    </div>
    <script>
        // [The Dar..., The Roal...., Fantastic..., The Grand...]
        const alphOrderAsc = [0, 3, 1, 2];
        const yearOrderAsc = [1, 0, 2, 3];
        const rateOrderAsc = [0, 1, 2, 3];
        const timeOrderAsc = [1, 3, 0, 2];

        let movieData = {
            "The Darjeeling Limited": {
                plot: "A year after their father's funeral, three brothers travel across India by train in an attempt to bond with each other.",
                cast: [
                    "Jason Schwartzman",
                    "Owen Wilson",
                    "Adrien Brody"
                ],
                runtime: 151,
                rating: 7.2,
                year: 2007,
            },
            "The Royal Tenenbaums": {
                plot: "The eccentric members of a dysfunctional family reluctantly gather under the same roof for various reasons",
                rating: 7.6,
                year: 2001,
                cast: [
                    "Gene Hackman",
                    "Gwnyeth Paltrow",
                    "Anjelica Huston"
                ],
                runtime: 170,
            },
            "Fantastic Mr. Fox": {
                year: 2009,
                plot: "An urbane fox cannot resist returning to his farm raiding ways and then must help his community survive the farmers' retaliation.",
                cast: [
                    "George Clooney",
                    "Meryl Streep",
                    "Bill Murray",
                    "Jason Schwartzman",
                ],
                runtime: 147,
                rating: 7.9,
            },
            "The Grand Budapest Hotel": {
                rating: 8.1,
                runtime: 159,
                year: 2014,
                plot: "A writer encounters the owner of an aging high-class hotel, who tells him of his early years serving as a lobby boy in the hotel's glorious years under an exceptional concierge.",
                cast: [
                    "Ralph Fiennes",
                    "F. Murray Abraham",
                    "Mathieu Amalric"
                ],
            },
        };

        // cast selection

        // add movie
        function addMovie() {
            let form = document.getElementsByTagName("form");
            const data = new FormData(form[0]);
            movieTitle = data.get("title");
            newMovieInfo = {};
            data.forEach((value, key) => { if (key !== "title") newMovieInfo[key] = value });
            movieData[movieTitle] = newMovieInfo;

            createCard(movieTitle);
        }

        function updateMovie() {
            let form = document.getElementsByTagName("form");
            const data = new FormData(form[1]);
            title = document.getElementById("movieTitle").innerHTML;
            let oldData = movieData[title];
            data.forEach((value, key) => { if (value !== oldData[key]) oldData[key] = value });
            console.log(movieData[title]);
            updateCard(title);
            closeForm();
        }

        function updateCard(title) {
            let card = document.getElementById(title);
            movieInfo = movieData[title];
            for (const key in movieInfo) {
                let index = 2;
                card.childNodes[index].innerHTML = movieInfo[key];
                index++;
            };
        }
        
        function createList() {
            for (const key in movieData) {
                createCard(key);
            }
        }

        function createCard(key) {
            let infoKey = movieData[key];
            let movieEntry = document.createElement("div");
            movieEntry.setAttribute("class", "card")
            movieEntry.setAttribute("style", "order: 0")
            movieEntry.setAttribute("id", key);
            let movieTitle = document.createElement("p");
            let movieInfo = document.createElement("ul");
            let rating = document.createElement("li");
            // rating.setAttribute("id", "rating");
            let cast = document.createElement("li");
            // cast.setAttribute("id", "cast");
            let runtime = document.createElement("li");
            // runtime.setAttribute("id", "runtime");
            let year = document.createElement("li");
            // year.setAttribute("id", "year");
            let plot = document.createElement("li");
            // plot.setAttribute("id", "plot");
            let edit = document.createElement("button");
            edit.setAttribute("class", "btn")
            edit.setAttribute("onclick", "openForm('" + key + "')");
            movieTitle.innerHTML = key;
            plot.innerHTML = "plot: " + infoKey["plot"];
            year.innerHTML = "year: " + infoKey["year"];
            runtime.innerHTML = "runtime: " + infoKey["runtime"] + "min";
            rating.innerHTML = "rating: " + infoKey["rating"];
            cast.innerHTML = "cast: " + infoKey["cast"];
            edit.innerHTML = "edit";
            movieEntry.appendChild(movieTitle);
            movieEntry.appendChild(movieInfo);
            movieEntry.appendChild(plot);
            movieEntry.appendChild(year);
            movieEntry.appendChild(runtime);
            movieEntry.appendChild(rating);
            movieEntry.appendChild(cast);
            movieEntry.appendChild(edit);
            let movies = document.getElementById("movies");
            movies.appendChild(movieEntry);
        };


        // IMPROVEMENT  toggle rather than two functions
        function openForm(key) {
            document.getElementById("editForm").style.display = "block";
            document.getElementById("blur").style.display = 'block';
            setPlaceholders(key)
        }

        function closeForm() {
            document.getElementById("editForm").style.display = "none";
            document.getElementById("blur").style.display = 'none';
        }

        function setPlaceholders(key) {
            let data = movieData[key];
            console.log(key)
            document.getElementById("movieTitle").innerHTML = key;
            document.getElementById("uplot").setAttribute("value", data["plot"]);
            document.getElementById("uyear").setAttribute("value", data["year"]);
            document.getElementById("uruntime").setAttribute("value", data["runtime"]);
            document.getElementById("urating").setAttribute("value", data["rating"]);
            document.getElementById("ucast").setAttribute("value", data["cast"]);
        }

        function reorder(order = null) {
            if (order == null) {
                createList()
            } else {
                const cards = document.getElementsByClassName("card");
                Array.from(cards).forEach((element, index) => {
                    element.setAttribute("style", "order: " + order[index])
                }); {
                }

                // 
                // potential but for aesthetics rather than clearing child nodes, just use css to move elements
                // 

                // const temp = document.createDocumentFragment();
                // const container = document.getElementById("movies");
                // for (let index in order) {temp.appendChild(cards[index])};
                // container.appendChild(temp);
            }
        };

        reorder();
    </script>
</body>

</html>